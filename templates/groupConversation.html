{% extends 'base.html' %}
{% load static %}
{% block content %}
        <!-- Heading -->
        <div class="row heading">
          <div class="col-sm-8 col-xs-7 heading-name">
            <a class="heading-name-meta">{{group.name}}
            </a>
          </div>
        </div>
        <!-- Heading End -->

        <!-- Message Box -->
        <div class="row message" id="conversation">

          
        </div>
        <!-- Message Box End -->

        <!-- Reply Box -->
        <form id="post-form">
            {% csrf_token %}
            <input type="hidden" name="group" id="group" value="{{group.group}}"/>
            <input type="hidden" name="origin" id="origin" value="{{name}}"/>
            <div class="row reply">
                <div class="col-sm-10 col-xs-10 reply-main">
                    <input class="form-control" type="text" name="message" id="message"/>
                </div>
                <div class="col-sm-2 col-xs-2 reply-recording">
                    <p align="right"><button type="submit" class="btn btn-success">Send</button></p>
                </div>
            </div>
        </form>
        <!-- Reply Box End -->

        <script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>

        <script>
            $(document).ready(function(){
            
            setInterval(function(){
                $.ajax({
                    type: 'GET',
                    url : "/getmessagesgroup/{{group.pk}}/",
                    success: function(response){
                        $("#conversation").empty();
                        for (var key in response.messages)
                        {
                            var temp="<div class='row message-body'><b>"+response.messages[key].origin+"</b><p>"+response.messages[key].message+"</p><span class='time-left'>"+response.messages[key].date+"</span></div>";
                            $("#conversation").append(temp);
                        }
                    },
                    error: function(response){
                        alert('An error occured')
                    }
                });
            },1000);
            })
        </script>

        <script type="text/javascript">
            $(document).on('submit','#post-form',function(e){
              e.preventDefault();
          
              $.ajax({
                type:'POST',
                url:'/sendg',
                data:{
                    group:$('#group').val(),
                    message:$('#message').val(),
                    origin:$('#origin').val(),
                  csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
                },
                success: function(data){
                   //alert(data)
                }
              });
              document.getElementById('message').value = ''
            });
        </script>

{% endblock %}